<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<base href=""> <!-- relative -->
		<title>Sandbox / Panels / Layout / 3-Columns</title>
		
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css">
		<linkx rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css">
		<script src="../v2/fanstatic.js"></script>
		<script>
			{
				let fanstatic_version = 'v2';
				let fanstatic_base_dir = '';
				let origin = window.location.origin;
				let host_env = null;
				
				const resolveOrigin = async function(){
					// resolve relative origin
					[
						'http://localhost/fanstatic3'
					].forEach(path => {
						if (window.location.href.startsWith(path)) origin = path;
					});

					// resolve absolute origin
					if (!host_env) {
						host_env = await fanstatic.fetchJson(origin + '/env.' + origin.replace(/[:/]/g, "_") + '.json');
					}

					document.head.querySelector('base').href = host_env.base_url; // make base URI absolute
					fanstatic_base_dir = document.baseURI + fanstatic_version;
				}
				
				const loadExtensions = async function(asyncCounter) {
					asyncCounter.counter = 6;
					
					window.addEventListener('fanstatic.visual.load', () => asyncCounter.done());
					window.addEventListener('fanstatic.design.load', () => asyncCounter.done());
					window.addEventListener('fanstatic.template.load', () => asyncCounter.done());
					window.addEventListener('fanstatic.style.load', () => asyncCounter.done());
					window.addEventListener('fanstatic.tools.load', () => asyncCounter.done());

					fanstatic.insertScripts([
						fanstatic_base_dir + '/ext.visual.js?' + fanstatic.tail(),
						fanstatic_base_dir + '/ext.design.js?' + fanstatic.tail(),
						fanstatic_base_dir + '/ext.tools.js?' + fanstatic.tail(),
						fanstatic_base_dir + '/ext.template.js?' + fanstatic.tail(),
						fanstatic_base_dir + '/ext.style.js?' + fanstatic.tail(),
					]).then(() => asyncCounter.done());
				}
				
				document.addEventListener('DOMContentLoaded', async function () {
					await resolveOrigin();
					await loadExtensions(fanstatic.asyncCounter(1, () => init()))
				});
				
				const init = async function(){
					const design = fanstatic.design;
					
					fanstatic.assign({
						base_url: document.baseURI,
						version: fanstatic_version,
						theme_style: 'none',
						theme_framework: 'sandbox',
						theme_mode: 'less',
						library_less_url: 'https://cdn.jsdelivr.net/npm/less',
						tail_span: '5s',
						log_render: false,
					})
					
					fanstatic.assignClassfix({
						'#hero': ['','padding-top: calc(4*var(--theme-padding)); padding-bottom: calc(3*var(--theme-padding)'],
						'#hero [data-pn-role="title"] > [data-ds] > *:first-child': ['','font-size: .5em;'],
						'#stack1 [data-ds="unit"]:nth-child(odd)': ['theme-sm-left-capped'],
						'#stack1 [data-ds="unit"]:nth-child(even)': ['theme-sm-right-capped'],
						'#stack1 [data-pn-role="title"] > [data-ds] > *': ['','font-size: 1.5em;'],
						'#stack1 [data-pn-role="footnote"] button': ['pure-button pure-button-primary'],
						'#foot [data-ds="unit_body"]': ['','flex:1; text-align:end;'],
						'#foot': ['','padding-block:var(--theme-padding);'],
					});
					
					fanstatic.insertScripts([
						document.baseURI + 'sandbox/panels.classfix.js?' + fanstatic.tail(),
					]);
					
					const promTheme = fanstatic.applyTheme();
					promTheme.then(() => { delayedRun() });

					const delayedRun = async function(){
						const template1 = await fanstatic.prependPanel(document.body, 'layout.1-column');
						
						template1.panelElement.style.display = 'none';
						await composeHeader(template1);
						await composeMain(template1);
						await composeFooter(template1);
						
						fanstatic.applyClassfix(document.body);
						
						template1.panelElement.style.display = 'block';
					};
					
					const composeHeader = async function(layoutController) {
						const template2 = await fanstatic.insertPanel(layoutController.headerElement, 'section.basic-header', {
							identity: true,
							navigation: true,
							actions: [],
						});
						
						const template3 = await fanstatic.insertPanel(template2.identityElement, 'block.identity', {
							label: 'My Landing Page'
						})
						
						const template4 = await fanstatic.insertPanel(template2.navigationElement, 'navigation.basic-menu', {
							menus: [
								{ label: 'About Us' },
								{ label: 'Products' },
								{ label: 'Services' },
							]
						})
					}
					
					const composeMain = async function(layoutController) {
						const design = fanstatic.design;
						
						const hero = await fanstatic.appendPanel(layoutController.mainElement,
							'section.containerized-hero',
							{
								block: {
									headers: ['Sandbox', 'Welcome']
								}
							}
					    )
						
						hero.panelElement.id = 'hero';
						
						const stackedUnit = {
							cap: design.element('img', {src:"https://dummyimage.com/200x200/000/fff"}),
							headers: ['This is a stacked unit'],
							body: ['this is a content line 1', 'this is a content line 2'],
							footers: [design.button('Click me!')]
						}
						
						const stack1 = await fanstatic.appendPanel(layoutController.mainElement,
							'section.containerized-stack',
							{
								titles: 'Stacked Items',
								items: [stackedUnit, stackedUnit, stackedUnit],
								ends: 'Total 3 unit stacked',
							}
					   )
						
						stack1.panelElement.id = 'stack1';
					}
					
					const composeFooter = async function(layoutController) {
						const design = fanstatic.design;
						
						const section = await fanstatic.appendPanel(layoutController.footerElement,
							'section.containerized', 
							{
								items: [
									design.unit({style: {display: 'flex'}}, {
										subjects: 'My Company',
										notes: '2025'
									})
								]
							}
						);
						
						section.panelElement.id = 'foot'
					}
				};
			}
		</script>
	</head>

	<body></body>
</html>