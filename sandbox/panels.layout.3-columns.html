<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<base href=""> <!-- relative -->
		<title>Sandbox / Panels / Layout / 3-Columns</title>
		
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css">
		<script src="https://cdn.jsdelivr.net/npm/less"></script>
		<script src="../v2/fanstatic.js"></script>
		<script>
			{
				let fanstatic_engine_dir = '';
				let fanstatic_base_dir = '';
				let fanstatic_version = 'v2';
				let origin = window.location.origin;
				let host_env = null;
				
				document.addEventListener('DOMContentLoaded', async function () {
					await resolveOrigin();

					const asyncCounter = fanstatic.asyncCounter(7, () => init());

					window.addEventListener('fanstatic.visual.load', () => asyncCounter.done());
					window.addEventListener('fanstatic.design.load', () => asyncCounter.done());
					window.addEventListener('fanstatic.structured_html.load', () => asyncCounter.done());
					window.addEventListener('fanstatic.template.load', () => asyncCounter.done());
					window.addEventListener('fanstatic.theme.load', () => asyncCounter.done());
					window.addEventListener('fanstatic.tools.load', () => asyncCounter.done());

					fanstatic.insertScripts([
						fanstatic_base_dir + '/ext.visual.js?' + fanstatic.tail(),
						fanstatic_base_dir + '/ext.design.js?' + fanstatic.tail(),
						fanstatic_base_dir + '/ext.structured_html.js?' + fanstatic.tail(),
						fanstatic_base_dir + '/ext.tools.js?' + fanstatic.tail(),
						fanstatic_base_dir + '/ext.template.js?' + fanstatic.tail(),
						fanstatic_base_dir + '/ext.theme.js?' + fanstatic.tail(),
					]).then(() => asyncCounter.done());
				});
				
				const resolveOrigin = async function(){
					// relative origin
					[
						'http://localhost/fanstatic3'
					].forEach(path => {
						if (window.location.href.startsWith(path)) origin = path;
					});

					// absolute origin
					if (!host_env) {
						host_env = await fanstatic.fetchJson(origin + '/env.' + origin.replace(/[:/]/g, "_") + '.json');
					}

					document.head.querySelector('base').href = host_env.base_uri; // make base URI absolute
					fanstatic_base_dir = fanstatic_engine_dir = document.baseURI + fanstatic_version;
				}
				
				const init = async function(){
					const design = fanstatic.design;
					
					Object.assign(fanstatic.settings, {
						base_url: document.baseURI,
						version: fanstatic_version,
						theme: 'clean',
						theme_framework: 'pure',
						theme_prioritize: false,
						theme_mode: 'less',
						tail_span: '5s',
						log_render: false,
					})
					
					fanstatic.insertScripts([
						document.baseURI + 'sandbox/panels.classfix.js?' + fanstatic.tail(),
					]);
					
					const promTheme = fanstatic.applyTheme()
					promTheme.then(() => {
						console.log('ok')
						window.setTimeout(delayedRun, 75)
					})

					const delayedRun = async function(){
						var template;
						
						/* section 2 */
						template = await fanstatic.prependPanel(document.body, 'layout.3-columns', {
							data: {
								top: 'Header',
								startColumn: '1',
								mainColumn: '2',
								endColumn: '3',
								bottom: 'Bottom',
							},
						});
						//template.controller.topElement.innerHTML = 'Header';
						//template.controller.columnsElement.children[1].innerHTML = 'Main';
						//template.controller.bottomElement.innerHTML = 'Footer';
					};
				};
			}
		</script>
	</head>

	<body></body>
</html>