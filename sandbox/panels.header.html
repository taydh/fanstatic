<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<base href=""> <!-- relative -->
		<title>Sandbox / Panels / Header</title>
		
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css">
		<script src="../v2/fanstatic.js"></script>
		<script>
			{
				let fanstatic_engine_dir = '';
				let fanstatic_base_dir = '';
				let fanstatic_version = 'v2';
				let origin = window.location.origin;
				let host_env = null;
				
				const resolveOrigin = async function(){
					// resolve relative origin
					[
						'http://localhost/fanstatic3'
					].forEach(path => {
						if (window.location.href.startsWith(path)) origin = path;
					});

					// resolve absolute origin
					if (!host_env) {
						host_env = await fanstatic.fetchJson(origin + '/env.' + origin.replace(/[:/]/g, "_") + '.json');
					}

					document.head.querySelector('base').href = host_env.base_uri; // make base URI absolute
					fanstatic_base_dir = document.baseURI + fanstatic_version;
				}
				
				const loadExtensions = async function(asyncCounter) {
					asyncCounter.counter = 7;
					
					window.addEventListener('fanstatic.visual.load', () => asyncCounter.done());
					window.addEventListener('fanstatic.design.load', () => asyncCounter.done());
					window.addEventListener('fanstatic.structured_html.load', () => asyncCounter.done());
					window.addEventListener('fanstatic.template.load', () => asyncCounter.done());
					window.addEventListener('fanstatic.theme.load', () => asyncCounter.done());
					window.addEventListener('fanstatic.tools.load', () => asyncCounter.done());

					fanstatic.insertScripts([
						fanstatic_base_dir + '/ext.visual.js?' + fanstatic.tail(),
						fanstatic_base_dir + '/ext.design.js?' + fanstatic.tail(),
						fanstatic_base_dir + '/ext.structured_html.js?' + fanstatic.tail(),
						fanstatic_base_dir + '/ext.tools.js?' + fanstatic.tail(),
						fanstatic_base_dir + '/ext.template.js?' + fanstatic.tail(),
						fanstatic_base_dir + '/ext.theme.js?' + fanstatic.tail(),
					]).then(() => asyncCounter.done());
				}
				
				document.addEventListener('DOMContentLoaded', async function () {
					await resolveOrigin();
					await loadExtensions(fanstatic.asyncCounter(1, () => init()))
				});
				
				const contentData = {
					identity: {
						label: 'My Company'
					},
					navigation: {
						menus: [
							{ label: 'Home' },
							{ label: 'Services' },
							{ label: 'About Us' },
						]
					}
				}
				
				const init = async function(){
					Object.assign(fanstatic.settings, {
						base_url: document.baseURI,
						version: fanstatic_version,
						theme: 'clean',
						theme_framework: 'pure',
						theme_prioritize: false,
						theme_mode: 'less',
						library_less_url: 'https://cdn.jsdelivr.net/npm/less',
						tail_span: '5s',
						log_render: false,
					})
					
					fanstatic.insertScripts([
						document.baseURI + 'sandbox/panels.classfix.js?' + fanstatic.tail(),
					]);
					
					fanstatic.applyTheme().then(() => window.setTimeout(delayedRun, 100))
					
					const delayedRun = async function(){
						const header = document.querySelector('header');
						const main = document.querySelector('main');
						
						const design = fanstatic.design;
						
						const headerSection = await fanstatic.insertPanel(header, 'section.header-simple', {
							data: {
								identity: design.placeholder('identity'),
								navigation: design.placeholder('navMenu'),
							}
						});
						
						headerSection.panelElement.querySelector('[data-role="container"]').classList.add('theme-container');
						
						const identity = await fanstatic.replacePanel(
							headerSection.panelElement.querySelector('[data-design-placeholder="identity"]'),
							'block.identity-basic',
							{
								data: contentData.identity,
							}
						);
						
						const nav = await fanstatic.replacePanel(
							headerSection.panelElement.querySelector('[data-design-placeholder="navMenu"]'), 
							'navigation.simple',
							{
								data: contentData.navigation,
							}
						);
						
						nav.panelElement.querySelector('[data-scope="navigation.simple"][data-role="menu-list"]').classList.add('pure-menu-list');
						nav.panelElement.querySelector('[data-scope="navigation.simple"][data-role="menu-list"] > *').classList.add('pure-menu-item');
						nav.panelElement.querySelectorAll('[data-scope="navigation.simple"][data-role="menu-list"] a').forEach(a => a.classList.add('pure-menu-link'));
						
						const heroTop = await fanstatic.appendPanel(main, 'section.hero-top-simple', {
							data: {
								items: [
									design.element('div', 'Hero Top Simple')
								]
							}
						});
						
						heroTop.panelElement.style.backgroundColor = 'var(--theme-bg-color-primary)';
						
						header.style.display = 'block';
						main.style.display = 'block';
					}
				}
			}
		</script>
	</head>

	<body>
		<header style="display:none; float:left; width:100%;"></header>
		<main style="display:none;"></main>
	</body>
</html>