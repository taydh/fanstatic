<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<base href=""> <!-- relative -->
		<title>Sandbox / Panels / Section</title>
			
		<script src="../v2/fanstatic.js"></script>
		<script>
			{
				let fanstatic_engine_dir = '';
				let fanstatic_base_dir = '';
				let fanstatic_version = 'v2';
				let origin = window.location.origin;
				let host_env = null;
				
				document.addEventListener('DOMContentLoaded', async function () {
					await resolveOrigin();

					const asyncCounter = fanstatic.asyncCounter(7, () => init());

					window.addEventListener('fanstatic.visual.load', () => asyncCounter.done());
					window.addEventListener('fanstatic.design.load', () => asyncCounter.done());
					window.addEventListener('fanstatic.structured_html.load', () => asyncCounter.done());
					window.addEventListener('fanstatic.template.load', () => asyncCounter.done());
					window.addEventListener('fanstatic.theme.load', () => asyncCounter.done());
					window.addEventListener('fanstatic.tools.load', () => asyncCounter.done());

					fanstatic.insertScripts([
						fanstatic_base_dir + '/ext.visual.js?' + fanstatic.tail(),
						fanstatic_base_dir + '/ext.design.js?' + fanstatic.tail(),
						fanstatic_base_dir + '/ext.structured_html.js?' + fanstatic.tail(),
						fanstatic_base_dir + '/ext.tools.js?' + fanstatic.tail(),
						fanstatic_base_dir + '/ext.template.js?' + fanstatic.tail(),
						fanstatic_base_dir + '/ext.theme.js?' + fanstatic.tail(),
					]).then(() => asyncCounter.done());
				});
				
				const resolveOrigin = async function(){
					// relative origin
					[
						'http://localhost/fanstatic3'
					].forEach(path => {
						if (window.location.href.startsWith(path)) origin = path;
					});

					// absolute origin
					if (!host_env) {
						host_env = await fanstatic.fetchJson(origin + '/env.' + origin.replace(/[:/]/g, "_") + '.json');
					}

					document.head.querySelector('base').href = host_env.base_uri; // make base URI absolute
					fanstatic_base_dir = fanstatic_engine_dir = document.baseURI + fanstatic_version;
				}
				
				const init = async function(){
					const design = fanstatic.design;
					
					Object.assign(fanstatic.settings, {
						base_url: document.baseURI,
						version: fanstatic_version,
						theme: 'clean',
						theme_framework: 'pure',
						tail_span: '5s',
						log_render: false,
					})
					
					fanstatic.insertScripts([
						document.baseURI + 'sandbox/panels.classfix.js?' + fanstatic.tail(),
						document.baseURI + 'sandbox/panels.section.classfix.js?' + fanstatic.tail(),
					]);
					
					fanstatic.applyTheme().then(() => window.setTimeout(delayedRun, 75))
					
					const contentData = {
						hero1: {
							titles: ['Company X', 'the best of worlds'],
							contents: ['Hello', "what's up"],
							footnotes: ['Cyber City'],
						},
						hero2: {
							titles: ['Company X', 'the best of worlds'],
							contents: [
								design.grid([design.div('One'), design.div('Two'), design.div('Three')]
									, { style: 'grid-template-columns:1fr 2fr 1fr' })
							],
							footnotes: ['Cyber City'],
						},
						stacks1: {
							items: [{
								titles: ['Company X', 'the best of worlds'],
								contents: ['Hello', "what's up"],
								footnotes: ['Cyber City'],
							},{
								titles: ['Company X', 'the best of worlds'],
								contents: ['Hello', "what's up"],
								footnotes: ['Cyber City'],
							},{
								titles: ['Company X', 'the best of worlds'],
								contents: ['Hello', "what's up"],
								footnotes: ['Cyber City'],
							}]
						},
					}

					const delayedRun = async function(){
						const main = document.querySelector('main');
						var template;
						
						/* section 2 */
						template = await fanstatic.appendPanel(main, 'section.containerized-unit', {
							data: contentData.hero1,
						});
						template.controller.panelElement.id = 'section1';
						
						/* section 2 */
						template = await fanstatic.appendPanel(main, 'section.containerized-unit', {
							data: contentData.hero2,
						});
						template.controller.panelElement.id = 'section2';
						
						/* section 3 */
						template = await fanstatic.appendPanel(main, 'section.containerized-units', {
							data: contentData.stacks1,
						});
						template.controller.panelElement.id = 'section3';

						console.log(main.querySelector('section'));
					};
				};
			}
		</script>
	</head>

	<body>
		<main></main>
	</body>
</html>