{const _resolveSpan=function(span){let p=span.slice(-1);let n=span.slice(0,-1);let secMap={d:86400,h:3600,m:60,s:1};return secMap[p]*n*1e3};const _resolveCustomTrail=function(opt,settings){if(opt.hasOwnProperty("trail_key")&&!opt.trail_key)return{key:null,value:null};else if(!opt.hasOwnProperty("trail_key"))return false;let tail_key=opt.hasOwnProperty("trail_key")?opt.trail_key:settings.trail_key;let tail_span=opt.hasOwnProperty("trail_span")?opt.trail_span:settings.trail_span;let vs=vn=Date.now();let diff=_resolveSpan(tail_span);vs=vn-diff<vs?vs:vn;return{key:tail_key,value:String(vs)}};var fanstatic={settings:{current_script:document.currentScript,base_url:document.currentScript.dataset.baseUrl?document.currentScript.dataset.baseUrl:"https://fanstatic.annexdesk.com/",version:"v2",trail_key:"_",trail_span:"1d"},getVersionedBaseUrl:function(version=this.settings.version){return this.settings.base_url+version+"/"},assign:function(opt){Object.assign(this.settings,opt)},insertScripts:function(urls,defaultProperties={defer:1}){var nonEmptyUrls=[];for(let url of urls)if(!!url)nonEmptyUrls.push(url);urls=nonEmptyUrls;return new Promise(resolve=>{var el;var asyncCounter=this.asyncCounter(urls.length,()=>resolve(true));for(let url of urls){el=document.createElement("script");el.onload=()=>asyncCounter.done();el.onerror=()=>asyncCounter.done();for(let entry of Object.entries(defaultProperties)){el[entry[0]]=entry[1]}if(typeof url==="object"){el.src=url.src;for(let entry of Object.entries(url.attributes||{})){el.setAttribute(entry[0],entry[1])}}else{el.src=url}document.head.appendChild(el)}})},insertStyles:function(urls){var nonEmptyUrls=[];for(let url of urls)if(!!url)nonEmptyUrls.push(url);urls=nonEmptyUrls;return new Promise(resolve=>{var el;var asyncCounter=this.asyncCounter(urls.length,()=>resolve(true));for(let url of urls){el=document.createElement("link");el.onload=()=>asyncCounter.done();el.onerror=()=>asyncCounter.done();el.setAttribute("rel","stylesheet");el.href=url;document.head.appendChild(el)}})},insertLess:function(urls){var nonEmptyUrls=[];for(let url of urls)if(!!url)nonEmptyUrls.push(url);urls=nonEmptyUrls;return new Promise(resolve=>{var el;var asyncCounter=this.asyncCounter(urls.length,()=>resolve(true));for(let url of urls){el=document.createElement("link");el.onload=()=>asyncCounter.done();el.onerror=()=>asyncCounter.done();asyncCounter.done();el.setAttribute("rel","stylesheet/less");el.setAttribute("type","text/css");el.href=url;document.head.appendChild(el)}})},insertPreloads:function(items){var nonEmptyItems=[];for(let item of items)if(!!item)nonEmptyItems.push(item);items=nonEmptyItems;var el;for(let item of items){el=document.createElement("link");el.setAttribute("rel","preload");el.href=item.url;el.as=item.as;document.head.appendChild(el)}},includeScripts:function(urls,defaultProperties={defer:1}){const urls_=[];for(let url of urls){if(!document.querySelector('head > style[src="'+("object"==typeof url?url.src:url)+'"]')){urls_.push(url)}}return this.insertScripts(urls_,defaultProperties)},includeStyles:function(urls,defaultProperties={defer:1}){const urls_=[];for(let url of urls){if(!document.querySelector('head > script[href="'+url+'"]')){urls_.push(url)}}return this.insertStyles(urls_)},insertPreloads:function(items){const items_=[];for(let item of items){if(!document.querySelector('head > link[rel="preload"][href="'+item.url+'"]')){items_.push(item)}}return this.insertScripts(items_,defaultProperties)},asyncCounter:function(count,onComplete){return{counter:count,done:function(){if(0==--this.counter)onComplete()}}},removeTrailingSlash:function(str){return str.replace(/\/+$/,"")},withTrailingSlash:function(str){return"/"==str[str.length-1]?str:str+"/"},tail:function(asObject=false){return this.trail(asObject)},trail:function(asObjet=false){if(this.settings.tail_key)this.settings.trail_key=this.settings.tail_key;if(this.settings.tail_span)this.settings.trail_span=this.settings.tail_span;if(!this.settings.trail_key||!this.settings.trail_span)return{key:null,value:null};let vn=vs=Date.now();let diff=_resolveSpan(this.settings.trail_span);if(localStorage.hasOwnProperty("fanstatic.trail_value")){vs=localStorage.getItem("fanstatic.trail_value");vs=vn-diff<vs?vs:vn}if(vs==vn){localStorage.setItem("fanstatic.trail_value",vs)}let trail={key:this.settings.trail_key,value:String(vs)};return asObjet?trail:`${trail.key}=${trail.value}`},fetchUrls:async function(urls,opt){let result=[];for(let url of urls){let urlOpt;if(typeof url=="object"){urlOpt=url;url=urlOpt.url}if(!url.startsWith("http")&&url[0]!="/"){url=document.baseURI+url}let trail=_resolveCustomTrail(opt||{},this.settings)||this.trail(true);if(url[0]=="/")url=window.location.origin+url;url=new URL(url);if(trail.key)url.searchParams.append(...Object.values(trail));const response=await fetch(url);if(!response.ok){throw new Error(`[External text not found]`,url)}try{let type=urlOpt?.type||opt?.type||"text";result.push(await(type=="json"?response.json():response.text()))}catch(err){console.error("[File fetch error]",url.href,err);result.push(null)}}return result},fetchText:async function(urlRel,opt={}){let isArray=Array.isArray(urlRel);let result=await this.fetchUrls(isArray?urlRel:[urlRel],Object.assign(opt,{type:"text"}));return isArray?result:result[0]},fetchJson:async function(urlRel,opt={}){let isArray=Array.isArray(urlRel);let result=await this.fetchUrls(isArray?urlRel:[urlRel],Object.assign(opt,{type:"json"}));return isArray?result:result[0]},fetchYaml:async function(urlRel,opt={}){let isArray=Array.isArray(urlRel);let result=await this.fetchUrls(isArray?urlRel:[urlRel],Object.assign(opt,{type:"text"}));result=result.map(text=>jsyaml.load(text));return isArray?result:result[0]},getLandingPath:function(appendSlash=false){let path=(window.location.origin+window.location.pathname).slice(this.settings.base_url?.length-1||0);return appendSlash?"/"==path[path.length-1]?path:path+"/":path},getLandingPathEntries:function(){return this.getLandingPath(true).split("/").slice(1,-1)},getLandingPage:function(route,appendSlash=false){let lp=this.getLandingPath(appendSlash);let entry=Object.entries(route).find(a=>a[1].includes(lp));return entry?entry[0]:null},_commandAttributes:{},_commands:{},registerCommand:function(command,fn){if(this._commands.hasOwnProperty(command)){throw"âŒ Fail registering command: already exists"}this._commands[command]=fn},run:function(target,command,args){return this.runCommand(target,command,args)},runCommand:function(target,command,args){if(this.settings.log_render)console.log("ðŸ¤– command:",command,target);let fn=this._commands[command];if(fn)return fn(this,target,args)},searchAndRunCommand:async function(roof,suffix=""){let targets;for(let cmdSel of Object.entries(this._commandAttributes)){const attr=cmdSel[0]+suffix;targets=roof.querySelectorAll(`[${attr}]`);if(targets){for(let target of targets){const query=target.getAttribute(cmdSel[0]);const fn=cmdSel[1];target.removeAttribute(cmdSel[0]);await fn(this,target,query)}}}}};window.dispatchEvent(new CustomEvent("fanstatic.load"),{detail:fanstatic});console.log("â­ fanstatic usage visit https://fanstatic.annexdesk.com/docs/?doc=script-help")}{const _toStyleAttributesString=function(attributes){return Object.entries(attributes).map(([k,v])=>`${k}:${fanstatic.sanitizeAttrValue(v)}`).join(";")};const _toClassAttributesString=function(attributes){return attributes.map(v=>`${fanstatic.sanitizeAttrValue(v)}`).join(" ")};const _toDataAttributesString=function(attributes,suffix=""){return Object.entries(attributes).map(([k,v])=>{if(typeof v==="object"){return _toDataAttributesString(v,suffix+k+"-")}return suffix+`${k}="${fanstatic.sanitizeAttrValue(v)}"`}).join(" ")};const _toAttributesString=function(attributes){return Object.entries(attributes).map(([k,v])=>{if("data"===k&&typeof v==="object"){return _toDataAttributesString(v,"data-")}else if("style"===k&&typeof v==="object"){return'style="'+_toStyleAttributesString(v)+'"'}else if("class"===k&&Array.isArray(v)){return'class="'+_toClassAttributesString(v)+'"'}else if("$"==k[0]){return""}else{return`${k}="${v}"`}}).join(" ")};Object.assign(fanstatic,{tagFillContains:function(obj,searchText){return"object"==typeof obj&&obj?Object.entries(obj)[0][0].includes(searchText):false},renderJhtm:function(arr){var html="";if("boolean"==typeof arr)return html;if("number"==typeof arr)return String(arr);if(!Array.isArray(arr)&&typeof arr==="object")arr=[arr];if(1==arr.length&&null==arr[0])return html;for(let entry of arr){if(typeof entry==="string"){html+=entry;continue}else if(typeof entry==="number"){html+=String(entry);continue}if(false===!!entry){continue}entry=Object.entries(entry)[0];let tagFill=entry[0];let content=entry[1];let tagName=tagFill.split(" ")[0];let innerHTML="";if(false===!!content){continue}else if(typeof content==="string"){innerHTML=content}else if(typeof content==="number"){innerHTML=String(content)}else if(Array.isArray(content)||typeof content==="object"){innerHTML=this.renderJhtm(content)}html+=`<${tagFill}>${innerHTML}</${tagName}>`}return html},renderYhtm:function(yaml){if(!window.jsyaml){console.error("[Please load JS-YAML library first]")}var o=jsyaml.load(yaml);let html=this.renderJhtm(o);return html}});fanstatic.design={element:function(tag,attributes={},items=true){if("object"!=typeof attributes||Array.isArray(attributes)){items=attributes;attributes={}}let tagFill=tag+" "+_toAttributesString(attributes);return{[tagFill]:items}},tag:function(){return this.element(...arguments)},div:function(attributes={},items=true){if("object"!=typeof attributes||Array.isArray(attributes)){items=attributes;attributes={}}return this.element("div",attributes,items)},par:function(attributes={},items=true){if("object"!=typeof attributes||Array.isArray(attributes)){items=attributes;attributes={}}return this.element("p",attributes,items)},button:function(attributes={},model){if("object"!=typeof attributes||Array.isArray(attributes)){model=attributes;attributes={}}let tagFill=`button data-ds="button"`;return{[tagFill]:model}},unit:function(attributes={},model){if(!model){if(Object.keys(attributes).some(k=>"cap"==k||"head"==k||"body"==k||"foot"==k)){model=attributes;attributes={}}else{model={}}}let tagFill=(attributes.$tag||"div")+' data-ds="unit" '+_toAttributesString(attributes);let result={[tagFill]:[]};if(1==model.mode){if(!model.foot)model.foot=true;if(!model.cap)model.cap=true}else if(2==model.mode){model.cap=false;model.foot=false}else if(3==model.mode){if(!model.foot)model.foot=true;model.cap=false}else if(4==model.mode){if(!model.cap)model.cap=true;model.foot=false}if(model.cap)result[tagFill].push({[(attributes.$capTag||"figure")+' data-ds="cap"']:model.cap});if(model.head)result[tagFill].push({[(attributes.$headTag||"div")+' data-ds="head"']:model.head});if(model.body)result[tagFill].push({[(attributes.$bodyTag||"div")+' data-ds="body"']:model.body});if(model.foot)result[tagFill].push({[(attributes.$footTag||"div")+' data-ds="foot"']:model.foot});return result},wrap:function(attributes={},item=true){if("object"!=typeof attributes||Array.isArray(attributes)){item=attributes;attributes={}}let tagFill=(attributes.$tag||"div")+' data-ds="wrap" '+_toAttributesString(attributes);let result={};result[tagFill]=item;return result},axis:function(attributes={},model){if(Array.isArray(attributes)){model=attributes;attributes={}}let tagFill=(attributes.$tag||"div")+' data-ds="axis" '+_toAttributesString(attributes);let result={};let items=(Array.isArray(model)?model:model.items)||[];result[tagFill]=items;return result},list:function(attributes={},secondaryAttributes={},model){if(Array.isArray(attributes)){model=attributes;attributes={}}let listTag=attributes.$tag||model.listTag||"ul";let itemTag=["ul","ol"].includes(listTag)?"li":secondaryAttributes.$tag||model.listItemTag||"div";let tagFill=listTag+' data-ds="list" '+_toAttributesString(attributes);let result={};let items=(Array.isArray(model)?model:model.items)||[];result[tagFill]=items.map(item=>{let obj={};obj[itemTag+' data-ds="item" '+_toAttributesString(secondaryAttributes)]=item;return obj});return result},stack:function(attributes={},secondaryAttributes={},model){if(Array.isArray(attributes)){model=attributes;attributes={}}let tagFill=(attributes.$tag||"div")+' data-ds="stack" '+_toAttributesString(attributes);let result={};let items=(Array.isArray(model)?model:model.items)||[];result[tagFill]=items.map(item=>{return fanstatic.tagFillContains(item,'data-ds="stack_item"')?item:{[(secondaryAttributes.$tag||model.itemTag||"div")+' data-ds="stack_item" '+_toAttributesString(secondaryAttributes)]:item}});return result},grid:function(attributes={},secondaryAttributes={},model){if(Array.isArray(attributes)){model=attributes;attributes={};secondaryAttributes={}}if(typeof attributes.style==="object"){Object.assign(attributes.style,{display:"grid"})}else{attributes.style=(attributes.style||"")+"; display: grid;"}let tagFill=(attributes.$tag||"div")+' data-ds="grid" '+_toAttributesString(attributes);let result={};let items=(Array.isArray(model)?model:model.items)||[];result[tagFill]=items.map(item=>{return fanstatic.tagFillContains(item,'data-ds="grid_item"')?item:{[(secondaryAttributes.$tag||model.itemTag||"div")+' data-ds="grid_item" '+_toAttributesString(secondaryAttributes)]:item}});return result},flex:function(attributes={},secondaryAttributes={},model){if(Array.isArray(attributes)){model=attributes;attributes={};secondaryAttributes={}}if(typeof attributes.style==="object"){Object.assign(attributes.style,{display:"flex"})}else{attributes.style=(attributes.style||"")+"; display: flex;"}let tagFill=(attributes.$tag||"div")+' data-ds="flex" '+_toAttributesString(attributes);let result={};let items=(Array.isArray(model)?model:model.items)||[];result[tagFill]=items.map(item=>{return fanstatic.tagFillContains(item,'data-ds="flex_item"')?item:{[(secondaryAttributes.$tag||model.itemTag||"div")+'div data-ds="flex_item" '+_toAttributesString(secondaryAttributes)]:item}});return result},placeholder:function(name="",model=true){let tagFill=`span data-ds-placeholder="${name}"`;return{[tagFill]:model}},escapeHtml:function(obj,rules=null){if(Array.isArray(obj)){for(let i in obj){this.escapeHtml(obj[i],rules)}}else if(obj!==null&&typeof obj=="object"){const keys=Object.keys(obj);for(let k of keys){if(typeof obj[k]=="string"){const ruled=rules?rules(k,obj[k]):false;obj[k]=ruled||fanstatic.escapeHtml(obj[k])}else{this.escapeHtml(obj[k],rules)}}}}};window.dispatchEvent(new CustomEvent("fanstatic.design.load",{detail:fanstatic.design}))}{fanstatic.assign({style_base_url:null});Object.assign(fanstatic,{applyLess:function(url=fanstatic.settings.library_less_url){if(url){return fanstatic.insertScripts([url])}return false},applyTheme:function(opt={}){let theme=opt.theme||fanstatic.settings.theme||null;let framework=opt.framework||fanstatic.settings.theme_framework||null;const mode=opt.mode||fanstatic.settings.theme_mode||"css";const includeGlobal=opt.includeGlobal||true;const includeUtility=opt.includeUtility||false;const styleBaseUrl=fanstatic.withTrailingSlash(fanstatic.settings.style_base_url||fanstatic.getVersionedBaseUrl());theme=fanstatic.removePathCharacters(theme);framework=framework?fanstatic.removePathCharacters(framework):null;console.log("ðŸ–¼ï¸ Style theme applied: "+theme+" ("+framework+"), mode: "+mode);const themeFrameworkBaseUrl=framework?`${styleBaseUrl}theme-framework-adapters/${framework}/`:null;const themeBaseUrl=fanstatic.settings.theme_base_url||`${styleBaseUrl}themes/${theme}/`;const prom1="less"==mode?fanstatic.insertLess([includeGlobal?`${styleBaseUrl}themes/_global.less?${fanstatic.trail()}`:null,includeUtility?`${utilsBaseUrl}_compiler.less?${fanstatic.trail()}`:null,`${themeBaseUrl}less/_theme.less?${fanstatic.trail()}`,framework?`${themeFrameworkBaseUrl}less/_adapter.less?${fanstatic.trail()}`:null]):"css-dev"==mode?fanstatic.insertStyles([includeUtility?`${utilsBaseUrl}_base.css?${fanstatic.trail()}`:null,`${styleBaseUrl}themes/_global.css?${fanstatic.trail()}`,`${themeFrameworkBaseUrl}_framework.css?${fanstatic.trail()}`,`${themeBaseUrl}_base.css?${fanstatic.trail()}`]):fanstatic.insertStyles([includeUtility?`${utilsBaseUrl}utils.css?${fanstatic.trail()}`:null,`${themeBaseUrl}theme.css?${fanstatic.trail()}`]);const scriptsUrls=[includeGlobal?`${styleBaseUrl}themes/theme-global-script.js`+"?"+fanstatic.trail():false,`${themeBaseUrl}theme-script.js`+"?"+fanstatic.trail(),framework?`${themeFrameworkBaseUrl}theme-adapter-script.js`+"?"+fanstatic.trail():null];const prom2=fanstatic.insertScripts(scriptsUrls);const prom3="less"==mode?this.applyLess():new Promise(rs=>rs(null));return Promise.all([prom1,prom2,prom3])}});window.dispatchEvent(new CustomEvent("fanstatic.style.load"))}{const _parseData=function(text,type){switch(type){case"text/yaml":return jsyaml.load(text);break;case"text/json":return JSON.parse(text);break}return null};fanstatic.assign({local_area_id:"fanstatic-area",log_process:false});Object.assign(fanstatic._commands,{insert:async function(fanstatic,target,args){var template=args?.template||(target.dataset.templateUrl?target.dataset.templateUrl:target.querySelector("template"));var dataElement=target.querySelector('script[type="text/json"]')||target.querySelector('script[type="text/yaml"]');var data=dataElement?_parseData(dataElement.innerHTML,dataElement.getAttribute("type")):null;var templateOptions=Object.assign({renderer:target.dataset.templateRenderer||null,data:data},args?.templateOptions||{});await fanstatic.insert(target,template,templateOptions)},replace:async function(fanstatic,target,args){var template=args?.template||(target.dataset.templateUrl?target.dataset.templateUrl:target.querySelector("template"));var dataElement=target.querySelector('script[type="text/json"]')||target.querySelector('script[type="text/yaml"]');var data=dataElement?_parseData(dataElement.innerHTML,dataElement.getAttribute("type")):null;var templateOptions=Object.assign({renderer:target.dataset.templateRenderer||null,data:data},args?.templateOptions||{});await fanstatic.replace(target,template,templateOptions)},"replace-model":async function(fanstatic,target,args){var dataElement=target.querySelector('script[type="text/json"]')||target.querySelector('script[type="text/yaml"]');var data=args?.data||_parseData(dataElement.innerHTML,dataElement.getAttribute("type"));var template=args?.template||(target.dataset.templateUrl?target.dataset.templateUrl:target.querySelector("template"));await fanstatic.replace(target,template,{model:data,data:data})},"insert-model":async function(fanstatic,target,args){var dataElement=target.querySelector('script[type="text/json"]')||target.querySelector('script[type="text/yaml"]');var data=args?.data||_parseData(dataElement.innerHTML,dataElement.getAttribute("type"));var template=args?.template||(target.dataset.templateUrl?target.dataset.templateUrl:target.querySelector("template"));await fanstatic.insert(target,template,{model:data,data:data})},"replace-yaml":async function(fanstatic,target,args){var data=jsyaml.load(target.querySelector('script[type="text/yaml"]').innerHTML);var template=args?.template||(target.dataset.templateUrl?target.dataset.templateUrl:target.querySelector("template"));await fanstatic.replace(target,template,{model:data,data:data})},"insert-yaml":async function(fanstatic,target,args){var data=jsyaml.load(target.querySelector('script[type="text/yaml"]').innerHTML);var template=args?.template||(target.dataset.templateUrl?target.dataset.templateUrl:target.querySelector("template"));await fanstatic.replace(target,template,{model:data,data:data})},"insert-markdown":async function(fanstatic,target,args){var template=args?.template||(target.dataset.templateUrl?target.dataset.templateUrl:target.querySelector("template"));await fanstatic.insert(target,template,{renderer:"markdown"})}});Object.assign(fanstatic._commandAttributes,{"data-fanstatic":async function(fanstatic,target){if("TEMPLATE"==target.tagName){await fanstatic.runCommand(target,"replace",{template:target})}},"data-template":async function(fanstatic,target,query){let command=query;await fanstatic.runCommand(target,command)},"data-template-insert":async function(fanstatic,target,query){await fanstatic.runCommand(target,"insert",{template:query,templateOptions:fanstatic.elementStorage.get(target,"templateOptions")||null})},"data-template-replace":async function(fanstatic,target,query){await fanstatic.runCommand(target,"replace",{template:query,templateOptions:fanstatic.elementStorage.get(target,"templateOptions")||null})},"data-template-insert-model":async function(fanstatic,target,query){await fanstatic.runCommand(target,"insert-model",{template:query,data:fanstatic.elementStorage.get(target,"templateOptions").model||null})},"data-template-replace-model":async function(fanstatic,target,query){await fanstatic.runCommand(target,"replace-model",{template:query,data:fanstatic.elementStorage.get(target,"templateOptions").model||null})},"data-template-insert-markdown":async function(fanstatic,target,query){await fanstatic.runCommand(target,"insert-markdown",{template:query})}});Object.assign(fanstatic,{TEMPLATE_OPTMODE:{full:0,model:1,data:2},ELEMENT_STORAGE_KEYS:{PANEL_CONTROLLER:"fanstatic.panel_controller"},_getTemplateElement:function(url){return document.getElementById(this.settings.local_area_id)?.querySelector(`template[data-url="${url}"]`)},_templateCustomerMap:new Map,_loadTemplate:async function(urlRel,opt){let hasError=false;let tpl=this._getTemplateElement(urlRel);if(!tpl){const templateCustomerMap=fanstatic._templateCustomerMap;return new Promise(resolve=>{window.addEventListener("fanstatic.template_loaded:"+urlRel,()=>{if(!tpl){tpl=this._getTemplateElement(urlRel);templateCustomerMap.get(urlRel).count--}resolve(tpl)});if(!templateCustomerMap.has(urlRel)||0==templateCustomerMap.get(urlRel).count){templateCustomerMap.set(urlRel,{count:1});try{this.fetchText(urlRel,opt).then(text=>{tpl=document.createElement("template");tpl.innerHTML=text;tpl.setAttribute("data-url",urlRel);let fanArea=document.getElementById(this.settings.local_area_id);if(!fanArea){fanArea=document.createElement("div");fanArea.id=this.settings.local_area_id;document.body.append(fanArea)}fanArea.appendChild(tpl);window.dispatchEvent(new CustomEvent("fanstatic.template_loaded:"+urlRel))})}catch(error){hasError=error;if(error._part)throw error;else console.error(error.message,urlRel)}}else{templateCustomerMap.get(urlRel).count++}})}else{return tpl}},_resolvePartial:function(tplOrUrl,isMustache=false){let tpl=typeof tplOrUrl=="string"?this._getTemplateElement(url):tplOrUrl;if(!tpl)return false;let url=tpl.getAttribute("data-url");let tmp=tpl.content.cloneNode(true);let src=Array.from(tmp.children).find(n=>n.tagName==="SCRIPT"&&["","javascript"].includes(n.getAttribute("type")||""));let nodes=[];if(src)tmp.removeChild(src);for(let c of tmp.childNodes){if(c.tagName)nodes.push(c)}return{url:url,template:tpl,clonedContent:tmp,childrenNodes:nodes,scriptElement:src}},_resolveScriptOptions:function(scriptElement,url){var partScriptError=false;var sourceUrl=url?url:"template-"+Date.now();var scriptOpt={renderer:null,classfix:null,model:null,onload:null,oninsert:null,onplace:null,controller:null};try{let testOpt=new Function(`\n\n//# sourceURL=${sourceUrl}\n\n`+scriptElement.innerHTML)();if(testOpt){partScriptError=true;if(typeof testOpt==="object"){Object.assign(scriptOpt,testOpt)}else if(typeof testOpt==="function"){scriptOpt.onload=testOpt}}return scriptOpt}catch(error){error._script_url=url;throw error}},_onplaceQueue:[],_insertTemplate:async function(target,url,opt={},optMode,insertFn){if(optMode==1)opt={model:opt};else if(optMode==2)opt={data:opt};if(["after","before"].includes(insertFn)&&target==document.body){console.error("[cannot target document.body with insertAfter method]");return}if(this.settings.log_process)console.log("ðŸ§© resolving:",url);var tpl=url&&typeof url==="object"&&url.tagName==="TEMPLATE"?url:await this._loadTemplate(url,opt);var part=this._resolvePartial(tpl);var scriptOpt={};if(!part)return false;try{if(part.scriptElement){scriptOpt=this._resolveScriptOptions(part.scriptElement,part.url)}if(opt.renderer&&!scriptOpt.renderer)scriptOpt.renderer=opt.renderer;if(opt.classfix)scriptOpt.classfix=Object.assign(scriptOpt.classfix||{},opt.classfix);if(opt.model)scriptOpt.model=Object.assign(scriptOpt.model||{},opt.model);return await this._processPartial(target,url,opt,insertFn,part,scriptOpt)}catch(error){console.error("[error insert template]",url,error);return false}},_processPartial:async function(target,url,opt,insertFn,part,scriptOpt){let tmp=document.createElement("div");tmp.append(part.clonedContent);let text=tmp.innerHTML;if(scriptOpt.mutate){text=scriptOpt.mutate(text)}let model=scriptOpt.model||{};let renderers=scriptOpt.renderer||false?scriptOpt.renderer.split(" "):[];for(let r of renderers){switch(r){case"mustache":text=Mustache.render(text,model);break;case"markdown":text=marked.parse(text);break;case"yhtm":text=this.renderYhtm(text);break}}tmp.innerHTML=text;let nodes=[];tmp.childNodes.forEach(n=>nodes.push(n));let roof=tmp;if(scriptOpt.onload){await scriptOpt.onload(roof,opt.data,part.url)}if(opt.postload){await opt.postload(roof,scriptOpt.controller)}await this.searchOnLoadAndRun(roof);if(scriptOpt.classfix)this.applyClassfix(roof,scriptOpt.classfix,url);let targetParentElement=null;if(insertFn==="replaceElement"){target["after"](...tmp.childNodes);targetParentElement=target.parentElement;target.remove()}else{target[insertFn](...tmp.childNodes)}if(this.settings.log_process)console.log("ðŸ§µ inserted:",part.url);roof=["after","before","replaceElement"].includes(insertFn)?targetParentElement||target.parentElement:target;if(scriptOpt.oninsert){await scriptOpt.oninsert(nodes,opt.data,part.url)}if(opt.postinsert){await opt.postinsert(nodes,scriptOpt.controller)}if(typeof scriptOpt.onplace=="function"){let fn=async function(){await scriptOpt.onplace(nodes,opt.data,part.url)};this._onplaceQueue.push(fn)}if(document.body.contains(roof)){await this.searchOnPlaceAndRun(roof);if(this.settings.log_process)console.log("ðŸŽ¬ placed:",part.url);this.applyClassfixes(roof,url);if(this._onplaceQueue.length>0){let fn;while(this._onplaceQueue.length>0){fn=this._onplaceQueue.shift();await fn()}}}return Object.assign(scriptOpt.controller||{},{_template:{target:target,url:url,opt:opt,insertFn:insertFn,part:part,scriptOpt:scriptOpt}})},searchOnLoadAndRun:async function(roof){return this.searchAndRunCommand(roof)},searchOnPlaceAndRun:async function(roof){let count=0;let targets;for(let cmdSel of Object.entries(this._commandAttributes)){const attr=cmdSel[0]+"-onplace";targets=roof.querySelectorAll(`[${attr}]`);if(targets){count+=targets.length;for(let target of targets){const query=target.getAttribute(attr);const fn=cmdSel[1];target.removeAttribute(attr);await fn(this,target,query)}}}if(this.settings.log_process)console.log("searchOnPlaceAndRun:",count)},loadTemplates:async function(entries){let me=this;let promises=[];entries.forEach(entry=>promises.push(me._loadTemplate(entry)));return Promise.all(promises)},append:function(target,url,opt,optMode=0){return this._insertTemplate(target,url,opt,optMode,"append")},prepend:function(target,url,opt,optMode=0){return this._insertTemplate(target,url,opt,optMode,"prepend")},insert:function(target,url,opt,optMode=0){return this._insertTemplate(target,url,opt,optMode,"replaceChildren")},before:function(target,url,opt,optMode=0){return this._insertTemplate(target,url,opt,optMode,"before")},after:function(target,url,opt,optMode=0){return this._insertTemplate(target,url,opt,optMode,"after")},replace:function(target,url,opt,optMode=0){return this._insertTemplate(target,url,opt,optMode,"replaceElement")},appendTemplate:function(...args){return this.append(...args)},prependTemplate:function(...args){return this.prepend(...args)},beforeTemplate:function(...args){return this.before(...args)},afterTemplate:function(...args){return this.after(...args)},insertTemplate:function(...args){return this.insert(...args)},replaceTemplate:function(...args){return this.replace(...args)},template:function(url,opt,optMode=0){this.url=url;this.options=opt||{};this.optMode=optMode;this.assignData=function(assignment){if(fanstatic.TEMPLATE_OPTMODE.data==this.optMode){Object.assign(this.options,assignment)}if(fanstatic.TEMPLATE_OPTMODE.full==this.optMode){this.options.data=Object.assign(this.options.data||{},assignment)}}},getPanelControllers:function(elements){return Array.from(elements).map(elem=>fanstatic.elementStorage.get(elem,fanstatic.ELEMENT_STORAGE_KEYS.PANEL_CONTROLLER))},_insertPanel:async function(el,panelScope,opt={},optMode,insertFn){return new Promise(async function(resolve){const c=await fanstatic[insertFn](el,fanstatic.resolvePanelPath(panelScope),opt,optMode);if(c.panelElement)fanstatic.elementStorage.set(c.panelElement,fanstatic.ELEMENT_STORAGE_KEYS.PANEL_CONTROLLER,c);resolve(c)})},resolvePanelScope:function(path){const parts=path.split("/").reverse();return parts[1]+"."+parts[0].substring(0,parts[0].lastIndexOf("."))},resolvePanelPath:function(panelScope){const panelBaseUrl=panelScope.match(/^.+?:\/\//i)?panelScope:fanstatic.settings.base_url+fanstatic.settings.version;return panelBaseUrl+"/panels/"+panelScope.replace(".","/")+".html"},insertPanel:async function(el,panelScope,opt,optMode=2){return this._insertPanel(el,panelScope,opt,optMode,"insert")},replacePanel:async function(el,panelScope,opt,optMode=2){return this._insertPanel(el,panelScope,opt,optMode,"replace")},appendPanel:async function(el,panelScope,opt,optMode=2){return this._insertPanel(el,panelScope,opt,optMode,"append")},prependPanel:async function(el,panelScope,opt,optMode=2){return this._insertPanel(el,panelScope,opt,optMode,"replace")},beforePanel:async function(el,panelScope,opt,optMode=2){return this._insertPanel(el,panelScope,opt,optMode,"before")},afterPanel:async function(el,panelScope,opt,optMode=2){return this._insertPanel(el,panelScope,opt,optMode,"after")},panel:function(panelScope,opt,optMode=2){this.panelScope=panelScope;this.options=opt||{};this.optMode=optMode;this.getData=function(){if(fanstatic.TEMPLATE_OPTMODE.full==this.optMode){if(!this.options.data)this.options.data={};return this.options.data}return this.options};this.outerScope=function(outerScope){const data=this.getData();data.scope=data.scope||outerScope};this.assignData=function(assignment){if(fanstatic.TEMPLATE_OPTMODE.data==this.optMode){Object.assign(this.options,assignment)}if(fanstatic.TEMPLATE_OPTMODE.full==this.optMode){this.options.data=Object.assign(this.options.data||{},assignment)}}},panelController:function(panelElement,scope,panelScope){this.panelElement=panelElement;this.scope=scope;this.panelScope=panelScope;this.select=function(name){return panelElement.querySelector(`[data-pn="${name}"]`)};this.selectAll=function(name){return panelElement.querySelectorAll(`[data-pn="${name}"]`)}},isTemplate:function(obj){return this.instanceOfTemplate(obj)||this.instanceOfPanel(obj)},instanceOfTemplate:function(obj){return obj instanceof fanstatic.template},instanceOfPanel:function(obj){return obj instanceof fanstatic.panel},applyTemplate:async function(target,obj,insertFn){if(obj instanceof fanstatic.panel){insertFn=(insertFn||"append")+"Panel";return fanstatic[insertFn](target,obj.panelScope,obj.options,obj.optMode)}else if(obj instanceof fanstatic.template){insertFn=(insertFn||"append")+"Template";return fanstatic[insertFn](target,obj.url,obj.options,obj.optMode)}return false},applyContent:function(target,content,outerScope=null,insertFn="append"){const arrContent=Array.isArray(content)?content:[content];for(let i=0;i<arrContent.length;i++){content=arrContent[i];if(fanstatic.isTemplate(content)){if(outerScope&&fanstatic.instanceOfPanel(content))content.outerScope(outerScope);return fanstatic.applyTemplate(target,content,insertFn)}else{target.innerHTML=fanstatic.renderJhtm?fanstatic.renderJhtm(content):content;return new Promise(rs=>rs(null))}}},removeLocalizedTemplates:function(){const localArea=document.getElementById(this.settings.local_area_id);if(localArea)localArea.remove();this._templateCustomerMap.clear()}});window.dispatchEvent(new CustomEvent("fanstatic.template.load"))}{const _elementStorage=new WeakMap;Object.assign(fanstatic,{copyValue:function(inputElem){inputElem.select();document.execCommand("copy")},getFirstElement:function(elementOrFragment){return elementOrFragment.firstChild?elementOrFragment.querySelector("*:not(:has(*))"):elementOrFragment},parseHTML:function(html,extractFirstElement=false){if(typeof html=="string"){var t=document.createElement("template");t.innerHTML=html;return extractFirstElement?this.getFirstElement(t.content):t.content}return html},insertHtml:function(el,html){el.empty();el.insertAdjacentHTML("beforeend",html)},replaceHtml:function(el,html){el.insertAdjacentHTML("afterend",html);el.remove()},beforeHtml:function(el,html){el.insertAdjacentHTML("beforebegin",html)},prependHtml:function(el,html){el.insertAdjacentHTML("afterbegin",html)},appendHtml:function(el,html){el.insertAdjacentHTML("before",html)},afterHtml:function(el,html){el.insertAdjacentHTML("afterend",html)},_classfixes:{general:{}},assignClassfix:function(obj,name="general"){Object.assign(this._classfixes[name],obj)},setClassfix:function(name,obj){this._classfixes[name]=obj},getClassfix:function(name="general"){return this._classfixes[name]},removeClassfix:function(name){delete this._classfixes[name]},applyClassfixes:function(roof,label){Object.entries(this._classfixes).forEach(([k,o])=>{this.applyClassfix(roof,o,`(${k}) `+label)})},applyClassfix:function(roof,source,label=""){const elems=[];const sourceArr=source?Object.entries(source):null;if(sourceArr){sourceArr.forEach(entry=>{roof.querySelectorAll(entry[0]).forEach(elem=>{elems.push(elem);let cls=!Array.isArray(entry[1])?entry[1]:entry[1][0];let stl=!Array.isArray(entry[1])?null:entry[1][1];if(cls)elem.classList.add(...cls.split(" "));if(stl)elem.setAttribute("style",(elem.getAttribute("style")||"")+";"+stl)})});if(this.settings.log_render)console.log(`ðŸŽ¨ classfix evaluated at ${label}:`,sourceArr.length,"applied:",elems.length)}else{if(this.settings.log_render)console.log(`ðŸŽ¨ no classfix evaluated at ${label}`)}},replaceWithChildren:function(oldParent,wrapper=null){if(!wrapper){oldParent.after(...oldParent.childNodes)}else{wrapper.append(...oldParent.childNodes);oldParent.after(wrapper)}oldParent.remove()},getSiblingGroups:function(firstChilds){firstChilds=firstChilds.values().toArray();var siblingGroups=[];for(let e of firstChilds){let siblings=[e];while(1){if(!e.nextElementSibling||firstChilds.includes(e.nextElementSibling)){siblingGroups.push(siblings);break}e=e.nextElementSibling;siblings.push(e)}}return siblingGroups},adoptSiblings:function(siblingGroupsOrFirstChilds,fnParent=function(){return document.createElement("div")},fnGrandParent){var grandParentElement;var tpl=document.createElement("template");var siblingGroups=Array.isArray(siblingGroupsOrFirstChilds)?siblingGroupsOrFirstChilds:this.getSiblingGroups(siblingGroupsOrFirstChilds);if(fnGrandParent){grandParentElement=fnGrandParent()}for(let siblings of siblingGroups){let parentElement=fnParent();for(let c of siblings){parentElement.append(c)}if(grandParentElement){grandParentElement.append(parentElement)}else tpl.content.append(parentElement)}if(grandParentElement)tpl.content.append(grandParentElement);return tpl.content},elementStorage:{_loadStore:function(target){if(_elementStorage.has(target)){return _elementStorage.get(target)}else{const store={};_elementStorage.set(target,store);return store}},set:function(target,key,val){const store=this._loadStore(target);store[key]=val},get:function(target,key){const store=this._loadStore(target);return store[key]},unset:function(target,key){const store=this._loadStore(target);delete store[key]},delete:function(target){_elementStorage.delete(target)}},escapeHtml:function(text){const element=document.createElement("div");element.textContent=text;return element.innerHTML},sanitizeAttrValue:function(value){return value.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},sanitizeFilename:function(input){let sanitized=input.replace(/[\/\\:*?"<>|]/g,"");sanitized=sanitized.replace(/[^a-zA-Z0-9._-]/g,"");sanitized=sanitized.replace(/^\.+/,"");sanitized=sanitized.substring(0,255);if(!sanitized){sanitized="_empty_sanitized_filename_"}return sanitized},removePathCharacters:function(value){return value.replace(/&/g,"").replace(/"/g,"").replace(/'/g,"").replace(/</g,"").replace(/>/g,"").replace(/\//g,"").replace(/\\/g,"")}});window.dispatchEvent(new CustomEvent("fanstatic.tools.load",{detail:fanstatic}))}{let _turnCount=0;let style=document.createElement("style");style.dataset.note="Fanstatic Visual";style.innerHTML=`*[data-visual-hidden] { visibility: hidden; }`;document.head.appendChild(style);fanstatic.registerCommand("viewport-enter-animate",function(fanstatic,elem){let animation=elem.dataset.visualAnimation;let turn=0;if(animation){fanstatic.visual.onEnterViewport(elem,function(){_turnCount++;let animate=function(){let classes=["animate__animated","animate__"+animation];_turnCount--;elem.classList.add(...classes);elem.removeAttribute("data-visual-hidden");elem.removeAttribute("data-visual-animation")};if(fanstatic.visual.settings.turn_delay>0){window.setTimeout(animate,(_turnCount-1)*fanstatic.visual.settings.turn_delay)}else{animate()}})}else{console.error("data-visual-animation attribute not found")}});fanstatic.visual={settings:{turn_delay:100,log_render:false},isOnScreen:function(elem,allowElemBehind=false,allowElemAhead=false){const scrollDist=document.documentElement.scrollTop;const elemOffset=window.scrollY+elem.getBoundingClientRect().top;if(!allowElemBehind&&!(elemOffset+elem.offsetHeight>scrollDist))return false;if(!allowElemAhead&&!(scrollDist+window.innerHeight>elemOffset))return false;return true},onEnterViewport:function(elem,handler,runOnce=true){let me=this;if(this.isOnScreen(elem)){if(this.settings.log_render)console.log("[Visual]","already in viewport",elem);handler();return}let evh=function(){if(me.isOnScreen(elem)){if(me.settings.log_render)console.log("[Visual]","entering viewport",elem);handler();if(runOnce)window.removeEventListener("scroll",evh)}};window.addEventListener("scroll",evh)}};window.dispatchEvent(new CustomEvent("fanstatic.visual.load",{detail:fanstatic.visual}))}