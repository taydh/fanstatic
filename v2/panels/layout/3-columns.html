<div>
	<header></header>
	<div data-pn="columns">
		<div data-pn="startColumn"></div>
		<main data-pn="mainColumn"></main>
		<div data-pn="endColumn"></div>
	</div>
	<footer></footer>
</div>

<script>
	const design = fanstatic.design;

	return async function(roof, data = {}, url) {
		const panelScope = data.panelScope || fanstatic.resolvePanelScope(url)
		const scope = data.scope || panelScope;
		
		const panelElement = roof.children[0];
		const headerElement = panelElement.children[0];
		const columnsElement = panelElement.children[1];
		const footerElement = panelElement.children[2];

		panelElement.dataset.pnPanel = panelScope;
		panelElement.dataset.pnScope = scope;

		this.controller = {
			panelElement: panelElement,
			headerElement: headerElement,
			startColumnElement: columnsElement.children[0],
			mainColumnElement: columnsElement.children[1],
			endColumnElement: columnsElement.children[2],
			footerElement: footerElement,
		}

		let headerProm, startProm, mainProm, endProm, footerProm;

		if (data.header) {
			if (fanstatic.isTemplate(data.header)) data.header.assignData({ scope: scope });
			headerProm = fanstatic.applyContent(headerElement, data.header);
		}

		if (data.startColumn) {
			if (fanstatic.isTemplate(data.startColumn)) data.startColumn.assignData({ scope: scope });
			startProm = fanstatic.applyContent(this.controller.startColumnElement, data.startColumn);
		}

		if (data.mainColumn) {
			if (fanstatic.isTemplate(data.mainColumn)) data.mainColumn.assignData({ scope: scope });
			mainProm = fanstatic.applyContent(this.controller.mainColumnElement, data.mainColumn);
		}

		if (data.endColumn) {
			if (fanstatic.isTemplate(data.endColumn)) data.endColumn.assignData({ scope: scope });
			endProm = fanstatic.applyContent(this.controller.endColumnElement, data.endColumn);
		}

		if (data.footer) {
			if (fanstatic.isTemplate(data.footer)) data.footer.assignData({ scope: scope });
			footerProm = fanstatic.applyContent(footerElement, data.footer);
		}

		const resolves = await Promise.all([headerProm, startProm, mainProm, endProm, footerProm]);

		this.controller.headerController = resolves[0];
		this.controller.startColumnController = resolves[1];
		this.controller.mainColumnController = resolves[2];
		this.controller.endColumnController = resolves[3];
		this.controller.footerColumnController = resolves[4];
		this.controller.scope = scope;
		this.controller.panelScope = panelScope;
	}
</script>