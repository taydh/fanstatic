<script>
	const design = fanstatic.design;

	return async function(roof, data = {}, url) {
		roof.innerHTML = fanstatic.renderJhtm(design.wrap([
			design.element('header'), design.element(data.mainTag ? data.mainTag : 'main'), design.element('footer'),
		]))

		const panelElement = roof.children[0];
		const headerElement = panelElement.children[0];
		const mainElement = panelElement.children[1];
		const footerElement = panelElement.children[2];

		this.controller = {
			panelElement: panelElement,
			headerElement: headerElement,
			mainElement: mainElement,
			footerElement: footerElement
		};

		const panelScope = data.panelScope || fanstatic.resolvePanelScope(url)
		const scope = data.scope || panelScope;

		panelElement.dataset.pnPanel = panelScope;
		panelElement.dataset.pnScope = scope;

		const headerProm = data.headerPanel
			? fanstatic.appendPanel(headerElement, data.headerPanel.panel, Object.assign({}, data.headerPanel.data, { scope: scope }))
			: new Promise(rs => rs(null));
		const mainProm = data.mainPanel
			? fanstatic.appendPanel(mainElement, data.mainPanel.panel, Object.assign({}, data.mainPanel.data, { scope: scope }))
			: new Promise(rs => rs(null));
		const footerProm = data.footerPanel
			? fanstatic.appendPanel(footerElement, data.footerPanel.panel, Object.assign({}, data.footerPanel.data, { scope: scope }))
			: new Promise(rs => rs(null));
			
		const resolves = await Promise.all([headerProm, mainProm, footerProm]);

		console.log(resolves)

		this.controller.headerController = resolves[0];
		this.controller.mainController = resolves[1];
		this.controller.footerController = resolves[2];
	}
</script>