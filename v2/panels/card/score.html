<script>
	const design = fanstatic.design;

	return async function(roof, data, url) {
		const panelElementId = data.$id || data.id || null;
		const panelScope = data.panelScope || fanstatic.resolvePanelScope(url);

		const basicUnitController = await fanstatic.insertPanel(roof, 'block.unit', {
			$id: panelElementId,
			panelScope: panelScope,
			scope: data.scope,
			innerScope: data.innerScope,
			cap: data.icon ? design.element('img', {src: data.icon}) : false,
			head: data.score,
			body: data.subject,
			foot: data.note,

			$tag: data.$tag || 'article',
			$attr: data.$attr,
			$capTag: data.$capTag,
			$headTag: data.$headTag,
			$bodyTag: data.$bodyTag,
			$footTag: data.$footTag,
		})

		const panelElement = basicUnitController.panelElement;
		const cap = panelElement.querySelector(':scope > [data-pn=cap]');
		const head = panelElement.querySelector(':scope > [data-pn=head]');
		const body = panelElement.querySelector(':scope > [data-pn=body]');
		const foot = panelElement.querySelector(':scope > [data-pn=foot]');
		
		if (data.icon) cap.dataset.pn = 'icon';
		if (data.score) head.dataset.pn = 'score';
		if (data.subject) body.dataset.pn = 'subject';
		if (data.note) foot.dataset.pn = 'note';
		
		this.controller = {
			panelElement: panelElement,
		}
	}
</script>