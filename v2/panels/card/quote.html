<script>
	const design = fanstatic.design;

	return async function(roof, data, url) {
		const panelElementId = data.$id || data.id || null;
		const panelScope = data.panelScope || fanstatic.resolvePanelScope(url);
		const photoUrl = data.photo || '';
		const tagFill = `img src="${photoUrl}"`;

		const baseBlockController = await fanstatic.appendPanel(roof, 'block.unit', {
			$id: panelElementId,
			panelScope: panelScope,
			scope: data.scope,
			innerScope: data.innerScope,
			cap: {[tagFill]: true},
			head: new fanstatic.panel('base.jhtm', [
				design.tag(data.$nameTag || 'div', {'data-pn': 'name' }, data.name), 
				design.wrap([
					design.tag(data.$titleTag || 'div', { 'data-pn': 'title' }, data.title),
					design.tag(data.$companyTag || 'div', { 'data-pn': 'company' }, data.company)
				])
			]),
			body: data.quote || true,

			$tag: data.$tag || 'article',
			$attr: data.$attr,
			$capTag: data.$photoTag,
			$headTag: data.$headTag,
			$bodyTag: data.$quoteTag || 'blockquote',
			$footTag: data.$footTag,
		})

		const panelElement = baseBlockController.panelElement;

		panelElement.querySelector(':scope > [data-pn=cap]').dataset.pn = 'photo';
		panelElement.querySelector(':scope > [data-pn=body]').dataset.pn = 'quote';

		this.controller = {
			panelElement: panelElement,
		};
	}
</script>