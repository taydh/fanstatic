<script>
	const design = fanstatic.design;

	return async function(roof, data = {}, url) {
		const panelElementId = data.$id || data.id || null;
		const panelScope = data.panelScope || fanstatic.resolvePanelScope(url);
		const model = {
			id: panelElementId,
			image: data.image || '',
			section: data.section || '',
			title: data.title || '',
			short: data.short || '',
			date: data.date || '',
			postLink: data.link || '#',

			author: data.author || '',
			authorLink: data.authorLink || '#',
			authorPhoto: data.authorPhoto || '',

			disabled: data.disabled || false,
		}
		const tagFill = `img src="${model.image}"`;

		const baseBlockController = await fanstatic.appendPanel(roof, 'block.unit', {
			$id: model.id,
			panelScope: panelScope,
			scope: data.scope,
			innerScope: data.innerScope,
			cap: {[tagFill]: true},
			head: [
				design.tag({$tag:data.$sectionTag || 'div', data:{'pn':'section'}}, model.section),
				design.tag({$tag:data.$titleTag || 'div', data:{'pn':'title'}}, design.element('a', {href: model.postLink}, model.title)),
				design.tag({$tag:data.$dateTag || 'div', data:{'pn':'date'}}, model.date),
				design.tag({$tag:data.$authorTag || 'div', data:{'pn':'author'}}, model.author), 
			],
			body: model.short || true,
			foot: [
				design.div([design.element('a', {href: model.postLink, data: {'pn': 'button-more'}}, 'Read more')]),
			],

			$tag: data.$tag || 'article',
			$attr: data.$attr,
			$capTag: data.$imageTag,
			$headTag: data.$headTag,
			$bodyTag: data.$shortTag,
			$footTag: data.$footTag,	
		})

		const panelElement = baseBlockController.panelElement;

		panelElement.querySelector(':scope > [data-pn=cap]').dataset.pn = 'image';
		panelElement.querySelector(':scope > [data-pn=body]').dataset.pn = 'short';

		this.controller = {
			panelElement: panelElement,
		};
	}
</script>