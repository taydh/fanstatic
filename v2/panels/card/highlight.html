<script>
	const design = fanstatic.design;

	return async function(roof, data = {}, url) {
		const panelElementId = data.$id || data.id || null;
		const panelScope = data.panelScope || fanstatic.resolvePanelScope(url);
		
		const model = {
			id: data.postId || '',
			backgroundImage: data.backgroundImage || '',
			cover: data.cover || '',
			reveal: data.reveal || '',
			disabled: data.disabled || false,
		}
		const tagFill = `img src="${model.backgroundImage}"`;

		const baseBlockController = await fanstatic.appendPanel(roof, 'block.unit', {
			$id: model.id,
			panelScope: panelScope,
			scope: data.scope,
			innerScope: data.innerScope,
			cap: {[tagFill]: true},
			head: model.cover,
			body: model.reveal,

			$tag: data.$tag || 'article',
			$attr: data.$attr,
			$capTag: data.$backgroundImageTag,
			$headTag: data.$coverTag,
			$bodyTag: data.$revealTag,
		})

		const panelElement = baseBlockController.panelElement;

		panelElement.querySelector(':scope > [data-pn=cap]').dataset.pn = 'background-image';
		panelElement.querySelector(':scope > [data-pn=head]').dataset.pn = 'cover';
		panelElement.querySelector(':scope > [data-pn=body]').dataset.pn = 'reveal';

		this.controller = {
			panelElement: panelElement,
		};
	}
</script>