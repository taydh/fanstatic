<script>
	const design = fanstatic.design;

	return async function (roof, data = {}, url) {
		const panelElementId = data.$id || data.id || null;
		const panelScope = data.panelScope || fanstatic.resolvePanelScope(url);
		const outerScope = data.scope;
		const innerScope = data.innerScope || outerScope || panelElementId || panelScope;

		roof.innerHTML = fanstatic.renderJhtm(design.element('section', data.$attr || {}, true));

		const panelElement = roof.children[0];

		if (panelElementId) panelElement.id = panelElementId;
		if (outerScope) panelElement.dataset.pnScope = outerScope;
		panelElement.dataset.pnPanel = panelScope;

		const contentBlockController = await fanstatic.insertPanel(panelElement, 'block.content', 
			Object.assign(data, {
				id: null,
				panelScope: null,
				scope: outerScope,
				innerScope: innerScope,

				$tag: data.blockTag,
				$attr: data.blockAttr,
				ignoreAttr: true,
			})
		);

		contentBlockController.panelElement.dataset.pn = 'container';

		this.controller = Object.assign(new fanstatic.panelController(panelElement, outerScope, panelScope), {
			containerElement: contentBlockController.panelElement,
			contentBlockController: contentBlockController,
		});
	}
</script>
