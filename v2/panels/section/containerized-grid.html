<script>
	const design = fanstatic.design;
	const controller = {
		panelElement: null,
		itemControllers: [],
	};

	return async function (roof, data, url) {
		const titles = data.titles || null
		const scope = fanstatic.resolvePanelScope(url);
		const panel = data.panel || 'block.base-block';
		const itemControllers = [];
		const data2 = {
			id: data.id || null,
			scope: scope,
			items: [
				(titles)
					? design.axis(titles.map(title => design.element('div', title)), {data:{thm:{scope:scope, role:'section_title'}}})
					: null,
				design.placeholder('panels'), 
			]
		};
		const tmpl1 = await fanstatic.insertPanel(roof, 'section.containerized', data2);
		const panelElement = tmpl1.panelElement;

		if (data.items) {
			const tmpl2 = await fanstatic.replacePanel(panelElement.querySelector('[data-ds-placeholder=panels]'), 'block.grid-panels', {
				scope: scope,
				panel: panel,
				items: data.items,
			});

			itemControllers.push(...tmpl2.itemControllers);
		}

		controller.panelElement = panelElement;
		controller.itemControllers = itemControllers;

		this.controller = controller;
	}
</script>
