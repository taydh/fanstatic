<section></section>

<script>
	const design = fanstatic.design;

	return async function (roof, data, url) {
		const panelScope = data.panel || fanstatic.resolvePanelScope(url);
		const outerScope = data.scope;
		const innerScope = data.innerScope || outerScope || data.id || panelScope;
		const panelElement = roof.children[0];

		if (data.id) panelElement.id = data.id;
		if (outerScope) panelElement.dataset.pnScope = outerScope;
		panelElement.dataset.pnPanel = panelScope;

		panelElement.innerHTML = fanstatic.renderJhtm([
			design.wrap(
				{data: {pn: 'container'}},
				[ 
					design.wrap({data: {pn:'identity'}}),
					design.wrap({data: {pn:'navigation'}}),
					design.wrap({data: {pn:'actions'}}),
				],
			)
		]);

		const controller = {
			panelElement: panelElement,
			identityElement: panelElement.querySelector(`:scope > [data-pn=container] > [data-pn=identity]`),
			navigationElement: panelElement.querySelector(`:scope > [data-pn=container] > [data-pn=navigation]`),
			actionsElement: panelElement.querySelector(`:scope > [data-pn=container] > [data-pn=actions]`)
		}

		let identityProm, navigationProm, actionsProm;

		if (data.identity)
			identityProm = fanstatic.applyContent(controller.identityElement, data.identity, innerScope);
		
		if (data.navigation)
			navigationProm = fanstatic.applyContent(controller.navigationElement, data.navigation, innerScope);

		if (data.actions)
			actionsProm = fanstatic.applyContent(controller.actionsElement, data.actions, innerScope);

		const allResolve = await Promise.all([identityProm, navigationProm, actionsProm]);

		controller.identityController = allResolve[0];
		controller.navigationsController = allResolve[1];
		controller.actionsController = allResolve[2];

		this.controller = controller;
	};
</script>
