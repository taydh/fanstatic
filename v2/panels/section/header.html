<section></section>

<script>
	const design = fanstatic.design;

	return async function (roof, data, url) {
		const panelScope = data.panel || fanstatic.resolvePanelScope(url);
		const outerScope = data.scope;
		const innerScope = data.innerScope || outerScope || data.id || panelScope;
		const panelElement = roof.children[0];

		if (data.id) panelElement.id = data.id;
		if (outerScope) panelElement.dataset.pnScope = outerScope;
		panelElement.dataset.pnPanel = panelScope;

		panelElement.innerHTML = fanstatic.renderJhtm([
			design.wrap(
				{data: {pn: 'container'}},
				[ 
					design.wrap({data: {pn:'identity'}}),
					design.wrap({data: {pn:'navigation'}}),
					design.wrap({data: {pn:'actions'}}),
				],
			)
		]);

		const controller = {
			panelElement: panelElement,
			identityElement: panelElement.querySelector(`:scope > [data-pn=container] > [data-pn=identity]`),
			navigationElement: panelElement.querySelector(`:scope > [data-pn=container] > [data-pn=navigation]`),
			actionsElement: panelElement.querySelector(`:scope > [data-pn=container] > [data-pn=actions]`)
		}

		if (data.identity)
			await fanstatic.appendPanel(controller.identityElement, data.identity.panel, data.identity.data);
		
		if (data.navigation)
			await fanstatic.appendPanel(controller.navigationElement, data.navigation.panel, data.navigation.data);

		if (data.actions)
			await fanstatic.appendPanel(controller.actionsElement, data.actions.panel, data.actions.data);

		this.controller = controller;
	};
</script>
