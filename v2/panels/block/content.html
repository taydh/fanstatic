<script>
	const design = fanstatic.design;

	return async function (roof, data = {}, url) {
		const panelScope = data.panelScope || fanstatic.resolvePanelScope(url);
		const outerScope = data.scope;
		const innerScope = data.innerScope || outerScope || data.id || panelScope;

		await fanstatic.appendPanel(roof, 'block.unit', {
			id: data.id,
			panelScope: panelScope,
			scope: data.scope,
			innerScope: data.innerScope,
			body: data.content || true,
			foot: data.footnote || true,

			$tag: data.$tag,
			$attr: data.$attr,
			$bodyTag: data.$contentTag,
			$footTag: data.$footnoteTag,
		});
		
		const panelElement = roof.children[0];
		
		if (data.id) panelElement.id = data.id;
		if (outerScope) panelElement.dataset.pnScope = outerScope;
		panelElement.dataset.pnPanel = panelScope;

		if (false !== data.headline) {
			panelElement.insertAdjacentHTML('afterbegin', fanstatic.renderJhtm(
				design.tag((data.$headlinedTag || 'hgroup'), { 'data-pn': 'headline'}, [
					design.tag((data.$categoryTag || 'div'), {'data-pn':'category'}, data.category || true),
					design.tag((data.$titleTag || 'h1'), {'data-pn':'title'}, data.title || true),
					design.tag((data.$subtitleTag || 'div'), {'data-pn':'subtitle'}, data.subtitle || true),
					design.tag((data.$captionTag || 'div'), {'data-pn':'caption'}, data.caption || true),
				])
			));
		}

		const body = panelElement.querySelector('[data-pn=body]');
		const foot = panelElement.querySelector('[data-pn=foot]');

		if (body) body.dataset.pn = 'content';
		if (foot) foot.dataset.pn = 'footnote';

		this.controller = {
			panelElement: panelElement,
			scope: outerScope,
			panelScope: panelScope,
			select: function(name) { return panelElement.querySelector(`[data-pn="${name}"]`); },
			selectAll: function(name) { return panelElement.querySelectorAll(`[data-pn="${name}"]`); },
		};
	};
</script>
