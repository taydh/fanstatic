<script>
	const design = fanstatic.design;

	return async function (roof, data = {}, url) {
		const panelElementId = data.$id || data.id || null;
		const panelScope = data.panelScope || fanstatic.resolvePanelScope(url);
		const outerScope = data.scope;
		const innerScope = data.innerScope || outerScope || panelElementId || panelScope;

		await fanstatic.appendPanel(roof, 'block.unit', {
			panelScope: panelScope,
			scope: data.scope,
			innerScope: data.innerScope,
			body: data.content || true,
			foot: (true !== data.noFootnote) ? data.footnote || true : false,

			$id: panelElementId,
			$tag: data.$tag,
			$attr: data.$attr,
			$bodyTag: data.$contentTag,
			$footTag: data.$footnoteTag,
		});
		
		const panelElement = roof.children[0];
		
		if (data.id) panelElement.id = data.id;
		if (outerScope) panelElement.dataset.pnScope = outerScope;
		panelElement.dataset.pnPanel = panelScope;

		if (true !== data.noHeadline) {
			panelElement.insertAdjacentHTML('afterbegin', fanstatic.renderJhtm(
				design.tag((data.$headlinedTag || 'hgroup'), { 'data-pn': 'headline'}, [
					design.tag((data.$categoryTag || 'div'), {'data-pn':'category'}, data.category || true),
					design.tag((data.$titleTag || 'h1'), {'data-pn':'title'}, data.title || true),
					design.tag((data.$subtitleTag || 'div'), {'data-pn':'subtitle'}, data.subtitle || true),
					design.tag((data.$captionTag || 'div'), {'data-pn':'caption'}, data.caption || true),
				])
			));
		}

		const body = panelElement.querySelector('[data-pn=body]');
		const foot = panelElement.querySelector('[data-pn=foot]');

		if (body) body.dataset.pn = 'content';
		if (foot) foot.dataset.pn = 'footnote';

		this.controller = Object.assign(new fanstatic.panelController(panelElement, outerScope, panelScope), {});
	};
</script>
