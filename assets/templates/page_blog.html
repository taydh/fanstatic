<script>
	return async function(roof, data) {
		var settings = await fanstatic.fetchJson('./contents/blog/settings.json')
		var usp = new URLSearchParams(window.location.search)

		if (!usp.has('post')) {
			await fanstatic.append(roof, './contents/blog/' + settings.index, {
				data: {
					settings: settings,
				}
			})
		}
		else {
			let slug = usp.get('post')
			let post = null

			if (post = settings.posts.find(o => o.slug == slug)) {
				const opt = {};

				if (post.renderer) opt.renderer = post.renderer;

				await fanstatic.loadTemplates([
					'./assets/templates/layout_blog.html',
					'./contents/blog/' + post.slug + '.md'])
				
				await fanstatic.append(roof, './assets/templates/layout_blog.html')

				roof.querySelector('.website-blog-title').innerHTML = fanstatic.sanitizeHtml(post.title);
				
				await fanstatic.append(roof.querySelector('.website-blog-content'), './contents/blog/' + post.slug + '.md', opt)
			}
		}
	}
</script>